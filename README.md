# Backend Social Application

ä¸€å€‹å®Œæ•´çš„ NodeJS Express å¾Œç«¯å°ˆæ¡ˆï¼Œæä¾›ç¤¾äº¤åª’é«”æ‡‰ç”¨ç¨‹å¼çš„æ ¸å¿ƒ API æœå‹™ã€‚

## å¿«é€Ÿé–‹å§‹

### 1. å®‰è£ä¾è³´

```bash
npm install
```

### 2. ç’°å¢ƒè¨­ç½®

```bash
# è¤‡è£½ç’°å¢ƒè®Šæ•¸ç¯„æœ¬
cp .env.example .env

# ç·¨è¼¯ç’°å¢ƒè®Šæ•¸
nano .env
```

### 3. è³‡æ–™åº«è¨­ç½®

```bash
# æ¸¬è©¦è³‡æ–™åº«é€£æ¥
docker compose exec app npm run db:quick
docker compose exec app npm run db:health
```

### 4. å•Ÿå‹•æ‡‰ç”¨ç¨‹å¼

```bash
docker compose up -d
```

## ğŸ§ª æ¸¬è©¦

| æŒ‡ä»¤                                            | æè¿°           |
| ----------------------------------------------- | -------------- |
| `docker compose exec app npm test`              | åŸ·è¡Œæ‰€æœ‰æ¸¬è©¦   |
| `docker compose exec app npm run test:coverage` | ç”Ÿæˆè¦†è“‹ç‡å ±å‘Š |
| `docker compose exec app npm run test:ci`       | CI/CD æ¸¬è©¦     |

## ğŸ”§ ç¨‹å¼ç¢¼å“è³ª

| æŒ‡ä»¤               | æè¿°               |
| ------------------ | ------------------ |
| `npm run lint`     | æª¢æŸ¥ç¨‹å¼ç¢¼é¢¨æ ¼     |
| `npm run lint:fix` | è‡ªå‹•ä¿®å¾©ç¨‹å¼ç¢¼å•é¡Œ |
| `npm run format`   | æ ¼å¼åŒ–ç¨‹å¼ç¢¼       |

## ğŸ“ å°ˆæ¡ˆçµæ§‹

```
backend-social-application/
â”œâ”€â”€ ğŸ“„ æ‡‰ç”¨ç¨‹å¼æ ¸å¿ƒ
â”‚   â”œâ”€â”€ app.js                    # Express æ‡‰ç”¨ç¨‹å¼ä¸»æ–‡ä»¶
â”‚   â””â”€â”€ bin/www                   # ä¼ºæœå™¨å•Ÿå‹•æ–‡ä»¶
â”‚
â”œâ”€â”€ ğŸ“‚ src/                       # æ ¸å¿ƒåŠŸèƒ½æ¨¡çµ„
â”‚   â”œâ”€â”€ ğŸ“‚ config/               # é…ç½®æª”æ¡ˆ
â”‚   â”œâ”€â”€ ğŸ“‚ database/             # è³‡æ–™åº«ç›¸é—œ
â”‚   â”‚   â”œâ”€â”€ sequelize.js         # Sequelize é…ç½®
â”‚   â”‚   â”œâ”€â”€ initDatabase.js      # è³‡æ–™åº«åˆå§‹åŒ–
â”‚   â”‚   â””â”€â”€ dbHealthCheck.js     # è³‡æ–™åº«å¥åº·æª¢æŸ¥
â”‚   â”œâ”€â”€ ğŸ“‚ models/               # è³‡æ–™æ¨¡å‹
â”‚   â”‚   â”œâ”€â”€ User.js              # ç”¨æˆ¶æ¨¡å‹
â”‚   â”‚   â”œâ”€â”€ Post.js              # è²¼æ–‡æ¨¡å‹
â”‚   â”‚   â”œâ”€â”€ Comment.js           # è©•è«–æ¨¡å‹
â”‚   â”‚   â””â”€â”€ Like.js              # æŒ‰è®šæ¨¡å‹
â”‚   â”œâ”€â”€ ğŸ“‚ routes/               # API è·¯ç”±
â”‚   â”‚   â”œâ”€â”€ index.js             # ä¸»è·¯ç”±
â”‚   â”‚   â”œâ”€â”€ users.js             # ç”¨æˆ¶è·¯ç”±
â”‚   â”‚   â””â”€â”€ posts.js             # è²¼æ–‡è·¯ç”±
â”‚   â”œâ”€â”€ ğŸ“‚ middlewares/          # ä¸­é–“ä»¶
â”‚   â”‚   â”œâ”€â”€ auth.js              # èº«ä»½é©—è­‰
â”‚   â”‚   â””â”€â”€ validation.js        # è³‡æ–™é©—è­‰
â”‚   â”œâ”€â”€ ğŸ“‚ services/             # æ¥­å‹™é‚è¼¯å±¤
â”‚   â”‚   â”œâ”€â”€ UserService.js       # ç”¨æˆ¶æœå‹™
â”‚   â”‚   â””â”€â”€ PostService.js       # è²¼æ–‡æœå‹™
â”‚   â”œâ”€â”€ ğŸ“‚ repositories/         # è³‡æ–™å­˜å–å±¤
â”‚   â”‚   â”œâ”€â”€ UserRepository.js    # ç”¨æˆ¶è³‡æ–™åº«æ“ä½œ
â”‚   â”‚   â”œâ”€â”€ PostRepository.js    # è²¼æ–‡è³‡æ–™åº«æ“ä½œ
â”‚   â”‚   â”œâ”€â”€ CommentRepository.js # è©•è«–è³‡æ–™åº«æ“ä½œ
â”‚   â”‚   â””â”€â”€ LikeRepository.js    # æŒ‰è®šè³‡æ–™åº«æ“ä½œ
â”‚   â””â”€â”€ ğŸ“‚ validations/          # é©—è­‰è¦å‰‡
â”‚       â””â”€â”€ schemas.js           # Joi é©—è­‰æ¨¡å¼
â”‚
â”œâ”€â”€ ğŸ“‚ tests/                    # æ¸¬è©¦æª”æ¡ˆ
â”‚   â”œâ”€â”€ ğŸ“‚ integration/          # æ•´åˆæ¸¬è©¦
â”‚   â”‚   â”œâ”€â”€ posts.*.spec.js      # è²¼æ–‡ç›¸é—œæ¸¬è©¦
â”‚   â”‚   â””â”€â”€ users.*.spec.js      # ç”¨æˆ¶ç›¸é—œæ¸¬è©¦
â”‚   â””â”€â”€ setup.js                 # æ¸¬è©¦ç’°å¢ƒè¨­ç½®
â”‚
â”œâ”€â”€ ğŸ“‚ api/                      # API æ–‡ä»¶
â”œâ”€â”€ ğŸ“‚ request/                  # API æ¸¬è©¦è«‹æ±‚
â”œâ”€â”€ ğŸ“‚ views/                    # EJS æ¨¡æ¿
â”œâ”€â”€ ğŸ“‚ .husky/                   # Git hooks
â”œâ”€â”€ ğŸ“„ docker-compose.yml        # Docker å®¹å™¨é…ç½®
â”œâ”€â”€ ğŸ“„ docker-compose-ci.yml     # Gitlab CI å®¹å™¨é…ç½®
â”œâ”€â”€ ğŸ“„ Dockerfile                # Docker æ˜ åƒæª”é…ç½®
â””â”€â”€ ğŸ“„ package.json              # å°ˆæ¡ˆé…ç½®
```

## ğŸ“¦ ä¸»è¦ä¾è³´

### æ ¸å¿ƒä¾è³´

| å¥—ä»¶                 | ç”¨é€”         |
| -------------------- | ------------ |
| `express`            | Web æ¡†æ¶     |
| `helmet`             | å®‰å…¨æ€§ä¸­é–“ä»¶ |
| `cors`               | CORS æ”¯æ´    |
| `dotenv`             | ç’°å¢ƒè®Šæ•¸ç®¡ç† |
| `express-rate-limit` | API é€Ÿç‡é™åˆ¶ |
| `express-validator`  | è«‹æ±‚é©—è­‰     |
| `bcryptjs`           | å¯†ç¢¼åŠ å¯†     |
| `jsonwebtoken`       | JWT èªè­‰     |

### è³‡æ–™åº«ç›¸é—œ

| å¥—ä»¶         | ç”¨é€”     |
| ------------ | -------- |
| `sequelize`  | ORM æ¡†æ¶ |
| `postgreSQL` | è³‡æ–™åº«   |

### é–‹ç™¼ä¾è³´

| å¥—ä»¶          | ç”¨é€”         |
| ------------- | ------------ |
| `mocha`       | æ¸¬è©¦æ¡†æ¶     |
| `chai`        | æ–·è¨€åº«       |
| `sinon`       | æ¨¡æ“¬åº«       |
| `supertest`   | HTTP æ¸¬è©¦    |
| `eslint`      | ç¨‹å¼ç¢¼æª¢æŸ¥   |
| `prettier`    | ç¨‹å¼ç¢¼æ ¼å¼åŒ– |
| `husky`       | Git hooks    |
| `lint-staged` | æš«å­˜æ–‡ä»¶æª¢æŸ¥ |

## ğŸ”— API ç«¯é»

### ç”¨æˆ¶ç›¸é—œ

| æ–¹æ³•   | ç«¯é»                  | æè¿°         |
| ------ | --------------------- | ------------ |
| `POST` | `/api/users/register` | ç”¨æˆ¶è¨»å†Š     |
| `POST` | `/api/users/login`    | ç”¨æˆ¶ç™»å…¥     |
| `GET`  | `/api/users/profile`  | å–å¾—ç”¨æˆ¶è³‡æ–™ |
| `PUT`  | `/api/users/profile`  | æ›´æ–°ç”¨æˆ¶è³‡æ–™ |

### è²¼æ–‡ç›¸é—œ

| æ–¹æ³•     | ç«¯é»                  | æè¿°         |
| -------- | --------------------- | ------------ |
| `GET`    | `/api/posts`          | å–å¾—è²¼æ–‡åˆ—è¡¨ |
| `POST`   | `/api/posts`          | å»ºç«‹æ–°è²¼æ–‡   |
| `GET`    | `/api/posts/:id`      | å–å¾—è²¼æ–‡è©³æƒ… |
| `PUT`    | `/api/posts/:id`      | æ›´æ–°è²¼æ–‡     |
| `DELETE` | `/api/posts/:id`      | åˆªé™¤è²¼æ–‡     |
| `POST`   | `/api/posts/:id/like` | æŒ‰è®šè²¼æ–‡     |
| `DELETE` | `/api/posts/:id/like` | å–æ¶ˆæŒ‰è®š     |

### è©•è«–ç›¸é—œ

| æ–¹æ³•     | ç«¯é»                      | æè¿°         |
| -------- | ------------------------- | ------------ |
| `GET`    | `/api/posts/:id/comments` | å–å¾—è²¼æ–‡è©•è«– |
| `POST`   | `/api/posts/:id/comments` | æ–°å¢è©•è«–     |
| `PUT`    | `/api/comments/:id`       | æ›´æ–°è©•è«–     |
| `DELETE` | `/api/comments/:id`       | åˆªé™¤è©•è«–     |

## ğŸ³ Docker éƒ¨ç½²

```bash
# å•Ÿå‹•æ‰€æœ‰æœå‹™
docker compose up -d

# æŸ¥çœ‹æœå‹™ç‹€æ…‹
docker compose ps

# åœæ­¢æœå‹™
docker compose down

```
